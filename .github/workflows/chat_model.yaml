name: load chat model

on: 
  push:
  pull_request:
  workflow_dispatch:

jobs:
  build:  

    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10"]

    steps:
      - uses: actions/checkout@v4
      - name: Set up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}
      - name: load model
        run: |
          which python
          date
          python ./demo.py
          #pytest -s -v ./test_1228.py
          #pip install transformers==4.30.2
          #pip install einops
          #pip install torch
          #pip install sentencepiece
          #python internlm2_7b.py
          
      - name: Convert to base64 and embed
        run: |
          # å°†å›¾ç‰‡è½¬æ¢ä¸º base64
          IMG_BASE64=$(base64 -w 0 ./deploy/output_simple.png)
          
          # æ„å»ºå®Œæ•´çš„ summary
          cat >> $GITHUB_STEP_SUMMARY << EOF
          # ğŸ“ˆ åˆ†ææŠ¥å‘Š
          
          ## æ€§èƒ½æ¯”è¾ƒå›¾
          
          ä¸‹å›¾å±•ç¤ºäº†ä¸åŒæ¨¡å‹çš„æ€§èƒ½å¯¹æ¯”ï¼š
          
          <div align="center">
          <img src="https://kkscilife.github.io/xtuner/qwen3-sft_comparison.png" 
               alt="æ€§èƒ½å¯¹æ¯”å›¾" 
               style="max-width: 90%; border: 1px solid #ddd; border-radius: 8px;">
          </div>
          <div align=center>
          <img src="https://raw.githubusercontent.com/kkscilife/xtuner/ci/debug/qwen3-sft_comparison.png" 
          style="width:80%">
          </div>
          
          ## å…³é”®æŒ‡æ ‡
          
          | æ¨¡å‹ | å‡†ç¡®ç‡ | æ¨ç†æ—¶é—´ | å†…å­˜ä½¿ç”¨ |
          |------|--------|----------|----------|
          | Model A | 92.3% | 45ms | 2.1GB |
          | Model B | 94.7% | 52ms | 2.4GB |
          | Model C | 96.1% | 61ms | 2.8GB |
          
          ## ç»“è®º
          - Model C å‡†ç¡®ç‡æœ€é«˜ï¼Œä½†æ¨ç†æ—¶é—´æœ€é•¿
          - éœ€è¦æ ¹æ®å®é™…åœºæ™¯æƒè¡¡é€‰æ‹©
          
          EOF

          #- name: Deploy to GitHub Pages
          #uses: JamesIves/github-pages-deploy-action@v4
          #with:
          #token: ${{ github.token }}
          #branch: gh-pages
          #folder: ./deploy
          #clean: true 
          #single-commit: true 
